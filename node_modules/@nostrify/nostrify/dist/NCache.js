import { LRUCache } from "lru-cache";
import { matchFilters } from "nostr-tools";
import { NSet } from "./NSet.js";
class NCache extends NSet {
  constructor(...args) {
    super(new LRUCache(...args));
  }
  async event(event) {
    this.add(event);
  }
  async query(filters) {
    const events = [];
    for (const event of this) {
      if (matchFilters(filters, event)) {
        this.cache.get(event.id);
        events.push(event);
      }
    }
    return events;
  }
  async remove(filters) {
    for (const event of this) {
      if (matchFilters(filters, event)) {
        this.delete(event);
      }
    }
  }
  async count(filters) {
    const events = await this.query(filters);
    return {
      count: events.length,
      approximate: false
    };
  }
  [Symbol.toStringTag] = "NCache";
}
export {
  NCache
};
