import { finalizeEvent, getPublicKey, nip04, nip44 } from "nostr-tools";
class NSecSigner {
  #secretKey;
  pubkey;
  constructor(secretKey) {
    this.#secretKey = secretKey;
  }
  async getPublicKey() {
    return this.pubkey ??= getPublicKey(this.#secretKey);
  }
  async signEvent(event) {
    return finalizeEvent(event, this.#secretKey);
  }
  nip04 = {
    encrypt: async (pubkey, plaintext) => {
      return nip04.encrypt(this.#secretKey, pubkey, plaintext);
    },
    decrypt: async (pubkey, ciphertext) => {
      return nip04.decrypt(this.#secretKey, pubkey, ciphertext);
    }
  };
  #getConversationKey(pubkey) {
    return nip44.v2.utils.getConversationKey(this.#secretKey, pubkey);
  }
  nip44 = {
    encrypt: async (pubkey, plaintext) => {
      const conversationKey = this.#getConversationKey(pubkey);
      return nip44.v2.encrypt(plaintext, conversationKey);
    },
    decrypt: async (pubkey, ciphertext) => {
      const conversationKey = this.#getConversationKey(pubkey);
      return nip44.v2.decrypt(ciphertext, conversationKey);
    }
  };
}
export {
  NSecSigner
};
